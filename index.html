<!DOCTYPE html>
<html>

<head>
	<meta charset='UTF-8'>
	<script src="https://d3js.org/d3.v4.js"></script>
    <script src="https://d3js.org/topojson.v1.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
	<!-- Latest compiled and minified CSS -->
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>

	<title>Flight Viz</title>
	
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	
	<!--[if !IE]><!-->
	<style>
	* { 
	  margin: 0; 
	  padding: 0; 
     }
     body { 
	   font: 14px/1.4 Georgia, Serif; 
     }
    #page-wrap {
	    margin: 50px;
    }
    p {
		font-family: Calibri, Candara, Segoe, "Segoe UI", Optima, Arial, sans-serif;
		font-size: 14px;
		margin-bottom: 20px ; 
		margin-right: 45px ;
		text-aling:justify;
		background-color: #f2f2f2;
    }
	
	

	h1 {
		font-family: Calibri, Candara, Segoe, "Segoe UI", Optima, Arial, sans-serif;
		font-size: 40px;
		text-align: center;
	}
	h2 {
		font-family: Calibri, Candara, Segoe, "Segoe UI", Optima, Arial, sans-serif;
		margin-left: 45px;
	}
	/* 
	Generic Styling, for Desktops/Laptops 
	*/
	table { 
		width: 100%; 
		border-collapse: collapse; 
	}
	/* Zebra striping */
	tr:nth-of-type(even) { 
		background:  #ccccff; 
	}
	tr:nth-of-type(odd) { 
		background:  #f2f2f2; 
	}
	
	
	th { 
		background:  #8080ff; 
		color: white; 
		font-weight: bold; 
		cursor: s-resize;
		background-repeat: no-repeat;
        background-position: 3% center;
	}
	th:after{
	content:"\21D4";
	display: inline-block;
	transform:rotate(90deg);
	
	}
	td, th { 
		padding: 6px; 
		border: 1px solid #ccc; 
		text-align: left; 
		
	}

	
	
	th.des:after {
      content: "\21E9";
	  display: inline-block;
	  transform:rotate(0deg);
    }
    
    th.aes:after {
      content: "\21E7";
	  display: inline-block;
	  transform:rotate(0deg);
    }
	select{
	  width: 150px;
	}
	
	.states {
            fill: #eee;
            stroke: #ccc;
            stroke-linejoin: round;
        }

    #map {
        margin: 30px 30px 0px 30px;
    }

    #map span {
        margin-right: 20px;
        font-size: 15px;
    }

    .track {
        stroke-linecap: round;
        stroke: #000;
        stroke-opacity: 0.3;
        stroke-width: 10px;
    }
		
	
	/* 
	Max width before this PARTICULAR table gets nasty
	This query will take effect for any screen smaller than 760px
	and also iPads specifically.
	*/
	@media 
	only screen and (max-width: 760px),
	(min-device-width: 768px) and (max-device-width: 1024px)  {
	
		/* Force table to not be like tables anymore */
		table, thead, tbody, th, td, tr { 
			display: block; 
		}
		
		/* Hide table headers (but not display: none;, for accessibility) */
		thead tr { 
			position: absolute;
			top: -9999px;
			left: -9999px;
		}
		
		tr { border: 1px solid #ccc; }
		
		td { 
			/* Behave  like a "row" */
			border: none;
			border-bottom: 1px solid #eee; 
			position: relative;
			padding-left: 50%; 
		}
		
		td:before { 
			/* Now like a table header */
			position: absolute;
			/* Top/left values mimic padding */
			top: 6px;
			left: 6px;
			width: 45%; 
			padding-right: 10px; 
			white-space: nowrap;
		}
		
		/*
		Label the data
		*/
		td:before {
		  content: attr(data-th) ": ";
          font-weight: bold;
          width: 6.5em;
          display: inline-block;
		}
	}
	
	/* Smartphones (portrait and landscape) ----------- */
	@media only screen
	and (min-device-width : 320px)
	and (max-device-width : 480px) {
		body { 
			padding: 0; 
			margin: 0; 
			width: 320px; }
		}
	
	/* iPads (portrait and landscape) ----------- */
	@media only screen and (min-device-width: 768px) and (max-device-width: 1024px) {
		body { 
			width: 495px; 
		}
	}
	
	.background path {
        fill: none;
        stroke: #ccc;
        stroke-opacity: .4;
        shape-rendering: crispEdges;
      }
	.foreground path {
	fill: none;
	stroke: steelblue;
	stroke-opacity: .7;
	stroke-width: 1.5;
	}
	.axis text {
	text-shadow: 0 1px 0 #fff;
	cursor: move;
	-webkit-text-stroke: 1px #fff;
	 color: black;
/*	 text-shadow:
	     2px 2px 0 #fff,
	     -2px -2px 0 #fff,  
	     2px -2px 0 #fff,
	     -2px 2px 0 #fff,
	     2px 2px 0 #fff;*/
	}
	div.tooltip { 
	    position: absolute;     
	    text-align: center;     
	    max-width: 70px;         
	    padding: 2px;       
	    font: 12px sans-serif;    
	    background: lightsteelblue; 
	    border: 0px;    
	    border-radius: 8px;     
	    pointer-events: none;     
	}
	.node {
	  box-sizing: border-box;
	  overflow: hidden;
         position: absolute;
         text-indent: 2px;
         text-align: center;
         vertical-align: middle;
	}

	.node-label {
	  padding: 4px;
	  line-height: 1em;
	  white-space: pre;
	}

	.node-value {
	  color: rgba(0,0,0,0.8);
	  font-size: 9px;
	  margin-top: 1px;
	}
	.monthLabel {
		margin: 0px;
		margin-left: 12px;
		margin-right: 50px;
		background: white;
	}
	.spanInfo {
		color: steelblue;
		margin-left: 2px;
		font-size: 18px;
	}
	.row {
		margin: 0;
	}
	h4 {
		float: right;
	}
	</style>
	<!--<![endif]-->

</head>

<body>
	<div style="float: right; margin-top: 60px"><p><a href="https://www.youtube.com/watch?v=7W7IEwE4C-I&feature=youtu.be">Video Overview</a></p><p><a href="https://docs.google.com/document/d/1jSiLdxol30Zd_XwON9EGjnhErV2PW9QRVOl-wje_610/edit?usp=sharing">Documentation</a></p></div>

<div style = "margin-left: 250px">
<div style="display:inline-block;">
<img src="logo.png" style="width:120px;height:120px;">
</div>
<div style="display:inline-block;">
<h1>Visualizing Flight Delay Data</h1>
<h2 style="text-align: center; color: steelblue">By Huayan Sun, Mei Yang and Hamid Mansoor </h2>
</div>
</div>
<br>
<p style="margin: 45px; margin-bottom: 10px;">Flying has never been easier or cheaper in USA than it is now. Flight delays and cancellations are a major concern for travellers as these events can cause everything from a ruined family vacation to serious monetary damage. We want to build a tool that gives travellers the ability to browse through flight delay and cancellation data for some recent years, across the major carriers in the US and major airports. After using this tool, travellers should be able to guage the performance of various carriers and airports. This tool also lets travellers anticipate a rise or fall in delays and cancellations across the seasons and regions of the US. Knowing this data could be useful for making travel plans. </p>
<h2>The Average On-Time Arrivals for Major Carriers For 2010 - 2015 </h2>
<p style="margin: 45px; margin-top: 10px; margin-bottom: 20px;">This chart gives you an overview of the flight punctiality performance for some major US carriers for the years 2011 - 2015. The values represent the percentage of flights that were on time. To single out a single carrier, please hover your mouse icon over the line representing the carrier to blur out the other information. </p>
<div id="graph" style="margin-top: 45px; margin-left:200px; margin-right: 45px; height: 410px;"></div>
<h2>The Average Flight Delay Between Major Airports</h2>
<p style="margin: 45px; margin-bottom: 5px; margin-top: 10px;">
	With this map, you can view the flight routes that different carriers provide and their delay performance over the past 6 years in a specific month. You can select a carrier and a month, and hovering any airport will display all flight routes from this selected origin. Average delay time in minutes is shown in the bar chart and you can click to compare it among different months.
</p>
<div id="map" style="margin-bottom: 45px;margin-left : 100px"></div>
 </div>
	<h2>Filterable Flight Delay Information Table</h2>
	<p style="margin: 45px; margin-bottom: 5px; margin-top: 10px;">
		This table is meant to give users an overview of the performance of various carriers for a particular route, during a particular season. To use this table, select the cities of origin and destination and the month for which your trip is palnned. The resulting table will show you time delay data across multiple carriers, along with the cause of the delay. The arrows in the column headers allow you to filter data in asceding or descending order for that particular metric. For example, to sort the rows in ascending order by the number of flights, click the upside of the two sided arrow in the column header for "Total Flights". You will also some donut charts at the bottom of the table which represnt the overall proportions of the various causes of delay for the carriers displayed.  
	</p>
	<div id="page-wrap" style="margin-left:45px; margin-right: 45px; width:auto">
	</div>
	<div id ="table" style = "display:inline-block;">
	<div id = "filter" style="margin-left:45px;width: 10%;display:inline-block;"><br/>
		<p style = "margin-top: -20px;margin-right:0px;width: 150px">Origin: </p>
		<div id="originFilter" style="width:100%; "></div>
		<p style = "margin-top: 40px;margin-right:0px;width: 150px">Destination: </p>
		<div id="destFilter" style="width:100%;"></div>
		
		<p style = "margin-top: 40px;margin-right:0px;width: 150px">Month: </p>
		<div id="monthFilter" style="width:100%;"></div>
		<button id="submit2" style = "margin-top: 40px; width :150px">Show Result</button>
	</div>
	<div id = "generalInfo" style=" margin-right:45px;width:79%;float:right;display:inline-block;">
	   
	</div>

</div>

<div id="pieLabel" style="margin-left:200px; margin-right: 45px; width:900px;height: 30px; display: block">
	</div>

<div id="piechart" style="margin-left:200px; margin-right: 45px; width:auto;height: 360px; display: block">
	</div>
<br>
	<h2>Cancellation Data For The Major Airlines For 2010 - 2015 </h2>
	<p style="margin: 45px; margin-bottom: 10px; margin-top:10px; ">The four categories of flight cancellation cause, as reported by the Department of Transportation, are: National Air System, Carrier, Weather and Security. We have implemented a grid of maps to allow you to explore the cancellation data across the major carriers in USA. The size of the tile represents the proportion of cancellations for that particular cause. By hovering over over a single tile, you will be able to see the number of cancellations for a carrier, along with the cause and month of cancellation. The code inside the tiles represents the carrier code. </p>
	<div style="height: 28px; margin-left: 45px; margin-bottom: 5px;">
		<p id="cancelInfo" style="display: none;">In the month of: <span id="monthSpan" class="spanInfo"></span>, there were: <span id="cancelSpan" class="spanInfo"></span> cancellations of flights by the carrier: <span id="carrierSpan" class="spanInfo"></span> and the cause of the cancellations was: <span id="causeSpan" class="spanInfo"></span>.</p>
	</div>
	<div style="width: 98%; margin-left: 23px;">
	<div class="row" >
		<div class="col-xs-3"><p class="monthLabel">January</p><div id="treemap1" style="height:  150px; position: relative; margin-left:10px;"></div></div>
		<div class="col-xs-3"><p class="monthLabel">February</p><div id="treemap2" style="height: 150px; position: relative;margin-left:10px;  "></div></div>
		<div class="col-xs-3"><p class="monthLabel">March</p><div id="treemap3" style="height: 150px; position: relative;margin-left:10px;  "></div></div>
		<div class="col-xs-3"><p class="monthLabel">April</p><div id="treemap4" style="height: 150px; position: relative;margin-left:10px;  "></div></div>
	</div>
	<div class="row">
		<div class="col-xs-3"><p class="monthLabel">May</p><div id="treemap5" style="height: 150px; position: relative;margin-left:10px;"></div></div>
		<div class="col-xs-3"><p class="monthLabel">June</p><div id="treemap6" style="height: 150px; position: relative;margin-left:10px;"></div></div>
		<div class="col-xs-3"><p class="monthLabel">July</p><div id="treemap7" style="height: 150px; position: relative;margin-left:10px;"></div></div>
		<div class="col-xs-3"><p class="monthLabel">August</p><div id="treemap8" style="height: 150px; position: relative;margin-left:10px;"></div></div>
	</div>

	<div class="row">
		<div class="col-xs-3"><p class="monthLabel">September</p><div id="treemap9" style= "height: 150px; position: relative;margin-left:10px;"></div></div> 
		<div class="col-xs-3"><p class="monthLabel">October</p><div id="treemap10" style="height: 150px; position: relative;margin-left:10px;"></div></div> 
		<div class="col-xs-3"><p class="monthLabel">November</p><div id="treemap11" style="height: 150px; position: relative;margin-left:10px;"></div></div> 
		<div class="col-xs-3"><p class="monthLabel">December</p><div id="treemap12" style="height: 150px; position: relative;margin-left:10px;"></div></div>
	</div>

	<script >
	  
	  // get airport data
    var airports = [];
    d3.json("airport.json", function(error, data) {
        if (error) throw error;

        data.forEach(function(d) {
            airports.push(d);
        });
    });
	 
      var carrierName = ["","American Airlines", "Alaska Airlines","JetBlue Airways","Delta Airlines","Frontier Airlines","Hawaiian Airlines","United Airlines", "Virgin America", "Southwest Airlines"];
      var month = ["","January","February","March","April","May","June","July","August","September","October","November","December"];
      var month1 = ["Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sept", "Oct", "Nov", "Dec"];
	  var origin = ["","Atlanta","Boston","Baltimore","Charlotte","Washington: DCA","Denver","Dallas/Fort","Detroit","Newark","Fort Lauderdale","Honolulu","Washington: IAD","Houston","New York: JFK","New York: LGA","Las Vegas","Los Angeles","Orlando","Chicago","Miami","Minneapolis","Chicago","Portland","Philadelphia","Phoenix","San Diego","Seattle","San Francisco","Salt Lake City","Tampa"];
      var color1 = d3.scaleOrdinal(d3.schemeCategory10);
      var carrier_selected;
      var month_selected = "Jan";
      var origin_selected = null;
	  var result = [];
	  var show = [];
	  var dataPie = [];
	  var dataCarrier =[];
	  var pielabel = ["NAS Delay","Security Delay","Aircraft Delay","Weather Delay","Carrier Delay"];
		
	  


	  var sCarrier = d3.select('#carrierF')
            .append('select')
            .attr('class','select1');
    sCarrier.selectAll('option')
            .data(carrierName).enter()
            .append('option')
            .text(function(d) {return d;});

    var sMonth = d3.select('#monthF')
            .append('select')
            .attr('class','select2');
    sMonth.selectAll('option')
            .data(month).enter()
            .append('option')
            .text(function(d) {return d;});

    var button = d3.select("#submit")
            .attr("onclick", "buildResult()");
			
	  
	  
	  
	  
	  
	  var selectOrigin = d3.select('#originFilter')
					 .append('select')
						.attr('class','selectOrigin')

	  var originOptions = selectOrigin.selectAll('option')
					.data(origin).enter()
					.append('option')
					 .text(function(d) {return d;})
	  var selectDest = d3.select('#destFilter')
					 .append('select')
						.attr('class','selectDest')
					 
	  var destOptions = selectDest.selectAll('option')
					.data(origin).enter()
					.append('option')
					 .text(function(d) {return d;})
					 
	  var selectCarrier = d3.select('#carrierFilter')
					 .append('select')
						.attr('class','selectCarrier')
					
	  var carrierOptions = selectCarrier.selectAll('option')
					.data(carrierName).enter()
					.append('option')
					 .text(function(d) {return d;})
					 
	  var selectMonth = d3.select('#monthFilter')
					 .append('select')
						.attr('class','selectMonth')
					 
	  var monthOptions = selectMonth.selectAll('option')
					.data(month).enter()
					.append('option')
					 .text(function(d) {return d;});

	  var button = d3.select("#submit2")
            .attr("onclick", "getvalue()")
			//.attr("onclick","drawPie()");	
	 // drawLegend();

      function initialTable(){
	  
		d3.csv("data/delay.csv", function(error, data) {
		  if (error) throw error;
		  
		  var sortAscending = true;
		  var table = d3.select('#generalInfo').append('table');
		  var titles = d3.keys(data[0]).filter(function(key){
		  
		  return key != "Origin" && key !="Destination" && key !="Month";
		  });
		  var headers = table.append('thead').append('tr')
		                   .selectAll('th')
		                   .data(titles).enter()
		                   .append('th')
		                   .text(function (d) {
			                    return d;
		                    })
		                   .on('click', function (d) {
		                	   headers.attr('class', 'header');
		                	   
		                	   if (sortAscending) {
		                	     rows.sort(function(a, b) { return b[d] < a[d]; });
		                	     sortAscending = false;
		                	     this.className = 'aes';
		                	   } else {
		                		 rows.sort(function(a, b) { return b[d] > a[d]; });
		                		 sortAscending = true;
		                		 this.className = 'des';
		                	   } 
		                	   
		                   });
		  
		 

	  });
	  
	  }
	  initialTable()
	
	  
	  function getvalue() {
		d3.select("#generalInfo").html("")
		d3.select("#piechart").html("")
		d3.select("#pieLabel").html("")
	 
		//carrierValue = d3.select('#carrierFilter').select('select').property('value')
	
		monthValue = d3.select('#monthFilter').select('select').property('value')
	
		originValue = d3.select('#originFilter').select('select').property('value')
		destValue = d3.select('#destFilter').select('select').property('value')
		
		
		//debugger
		var carrierInfor;
        var monthInfor;
		var originInfor;
		var destInfor;
		var piedata = [];
		var Carrierdata = [];
		
		 switch(originValue) {
		
            case "Atlanta":
                originInfor = "ATL";
                break;
            case "Boston":
                originInfor = "BOS";
                break;
            case "Baltimore":
                originInfor = "BWI";
                break;
            case "Charlotte":
                originInfor = "CLT";
                break;
            case "Washington: DCA":
                originInfor = "DCA";
                break;
			case "Washington: DCA":
                originInfor = "DCA";
                break;
            case "Denver":
                originInfor = "DEN";
                break;
            case "Dallas/Fort":
                originInfor = "DFW";
                break;
            case "Detroit":
                originInfor = "DTW";
                break;
            case "Newark":
                originInfor = "EWR";
                break;
			case "Fort Lauderdale":
                originInfor = "FLL";
                break;
            case "Honolulu":
                originInfor = "HNL";
                break;
            case "Houston":
                originInfor = "IAH";
                break;
            case "New York: JFK":
                originInfor = "JFK";
                break;
            case "Las Vegas":
                originInfor = "LAS";
                break;
            case "Los Angeles":
                originInfor = "LAX";
                break;
			case "Orlando":
                originInfor = "MCO";
                break;
            case "Chicago":
                originInfor = "MDW";
                break;
            case "Washington: IAD":
                originInfor = "IAD";
                break;
            case "New York: LGA":
                originInfor = "LGA";
                break;
            case "Miami":
                originInfor = "MIA";
                break;
            case "Minneapolis":
                originInfor = "MSP";
                break;
			case "Chicago":
                originInfor = "ORD";
                break;
            case "Portland":
                originInfor = "PDX";
                break;
            case "Philadelphia":
                originInfor = "PHL";
                break;
            case "Phoenix":
                originInfor = "PHX";
                break;
            case "San Diego":
                originInfor = "SAN";
                break;
            case "Seattle":
                originInfor = "SEA";
                break;
			case "San Francisco":
                originInfor = "SFO";
                break;
            case "Salt Lake City":
                originInfor = "SLC";
                break;
            case "Tampa":
                originInfor = "29";
                break;
            
        }
		switch(destValue) {
		
            case "Atlanta":
                destInfor = "ATL";
                break;
            case "Boston":
                destInfor = "BOS";
                break;
            case "Baltimore":
                destInfor = "BWI";
                break;
            case "Charlotte":
                destInfor = "CLT";
                break;
            case "Washington: DCA":
                destInfor = "DCA";
                break;
			case "Washington: DCA":
                destInfor = "DCA";
                break;
            case "Denver":
                destInfor = "DEN";
                break;
            case "Dallas/Fort":
                destInfor = "DFW";
                break;
            case "Detroit":
                destInfor = "DTW";
                break;
            case "Newark":
                destInfor = "EWR";
                break;
			case "Fort Lauderdale":
                destInfor = "FLL";
                break;
            case "Honolulu":
                destInfor = "HNL";
                break;
            case "Houston":
                destInfor = "IAH";
                break;
            case "New York: JFK":
                destInfor = "JFK";
                break;
            case "Las Vegas":
                destInfor = "LAS";
                break;
            case "Los Angeles":
                destInfor = "LAX";
                break;
			case "Orlando":
                destInfor = "MCO";
                break;
            case "Chicago":
                destInfor = "MDW";
                break;
            case "Washington: IAD":
                destInfor = "IAD";
                break;
            case "New York: LGA":
                destInfor = "LGA";
                break;
            case "Miami":
                destInfor = "MIA";
                break;
            case "Minneapolis":
                destInfor = "MSP";
                break;
			case "Chicago":
                destInfor = "ORD";
                break;
            case "Portland":
                destInfor = "PDX";
                break;
            case "Philadelphia":
                destInfor = "PHL";
                break;
            case "Phoenix":
                destInfor = "PHX";
                break;
            case "San Diego":
                destInfor = "SAN";
                break;
            case "Seattle":
                destInfor = "SEA";
                break;
			case "San Francisco":
                destInfor = "SFO";
                break;
            case "Salt Lake City":
                destInfor = "SLC";
                break;
            case "Tampa":
                destInfor = "TPA";
                break;
            
        }
		
		
		


        switch(monthValue) {
            case "January":
                monthInfor = 1;
                break;
            case "February":
                monthInfor = 2;
                break;
            case "March":
                monthInfor = 3;
                break;
            case "April":
                monthInfor = 4;
                break;
            case "May":
                monthInfor = 5;
                break;
            case "June":
                monthInfor = 6;
                break;
            case "July":
                monthInfor = 7;
                break;
            case "August":
                monthInfor = 8;
                break;
            case "September":
                monthInfor = 9;
                break;
            case "October":
                monthInfor = 10;
                break;
            case "November":
                monthInfor = 11;
                break;
            case "December":
                monthInfor = 12;
                break;
        }
		
		

		
	//debugger
		d3.csv("data/delay.csv", function(error, data) {
		  if (error) throw error;
		  
		  var sortAscending = true;
		  var table = d3.select('#generalInfo').append('table');
		  var titles = d3.keys(data[0]).filter(function(key){
		  
		  return key != "Origin" && key !="Destination" && key != "Month";
		  });
		  var result = [];
		  data.forEach(function(d){
			 if(d.Month == monthInfor&& d.Origin ==originInfor && d.Destination == destInfor ){
				
				result.push(d);
			 }
		  
		  });
		  show = result.filter(function(key){
		  
		  return key != "Origin" && key !="Destination" && key != "Month";
		  });
		  

		
		for(i = 0; i < show.length;i++ ){
			piedata.push([show[i]["NAS Delay"],show[i]["Security Delay"],show[i]["Aircraft Delay"],show[i]["Weather Delay"],show[i]["Carrier Delay"]])
		}
		
		for(i = 0; i < show.length;i++ ){
			Carrierdata.push([show[i]["Carrier"]])
		}
		
		dataPie = piedata;
		dataCarrier =Carrierdata; 
		drawLegend();
		drawPie();
		
//		   piedata = result.filter(function(key){
//		  
//		  return key != "Origin" && key !="Destination" && key != "Month" && key !="Percentage" && key != "Total Flight" && key != "Delay Flight" && key != "Total Delay Time:min";
//		  });
//		  
		  
		  
		  //&& key =="Weather Delay" && key == "NAS Delay" &&key =="Security Delay" && key == "Aircraft Delay"

		  
	




	
		

		  var headers = table.append('thead').append('tr')
		                   .selectAll('th')
		                   .data(titles).enter()
		                   .append('th')
		                   .text(function (d) {
			                    return d;
		                    })
		                   .on('click', function (d) {
		                	   headers.attr('class', 'header');
		                	   
		                	   if (sortAscending) {
		                	     rows.sort(function(a, b) { return b[d] < a[d]; });
		                	     sortAscending = false;
		                	     this.className = 'aes';
		                	   } else {
		                		 rows.sort(function(a, b) { return b[d] > a[d]; });
		                		 sortAscending = true;
		                		 this.className = 'des';
		                	   } 
		                	   
		                   });
		  
		  var rows = table.append('tbody').selectAll('tr')
		               .data(show).enter()
		               .append('tr');
		  rows.selectAll('td')
		    .data(function (d) {
		    	return titles.map(function (k) {
		    		return { 'value': d[k], 'name': k};
		    	});
		    }).enter()
		    .append('td')
		    .attr('data-th', function (d) {
		    	return d.name;
		    })
		    .text(function (d) {
		    	return d.value;
		    });
	  });
	  
	  
	  
		
	
	};
	
	function drawLegend(){
		var jsonCircles = [10,10,10,10,10];
   var color = ["#EA4335","#34A853","#4285F4","#FBBC05","#ccccff"];
 
 var svgContainer = d3.select("#pieLabel").append("svg")
                                     .attr("width", 1000)
                                     .attr("height", 30);
 
var circles = svgContainer.selectAll("circle")
                          .data(jsonCircles)
                          .enter()
                          .append("circle");

var circleAttributes = circles
							.attr("cx", function (d,i) { return 20+i*170; })
							.attr("cy", 10)
							.attr("r", 5)
							.style("fill", function(d, i) { return color[i]; })
var g = svgContainer.selectAll("g")
                          .data(jsonCircles)
                          .enter()
                          .append("g")
						  .append("text")
							.attr("dx", function(d,i){return 30+i*170;})
							.attr("dy", function(d){return 15;})
							.text(function(d,i){return pielabel[i];});
							

					  
	
	}
	
	function drawPie(){
		
	
		var m = 10,
			r = 80,
			radius = 80;
		var color = ["#EA4335","#34A853","#4285F4","#FBBC05","#ccccff"];
		var svg = d3.select("#piechart").selectAll("svg")
			.data(dataPie)
		.enter().append("svg")
			.attr("width", (r + m) * 2)
			.attr("height", (r + m) * 2)
		.append("g")
			.attr("transform", "translate(" + (r + m) + "," + (r + m) + ")");
		
		
		var c = svg.append("text")
					.attr("transform", "translate(" + -10 + "," + 0 + ")")
					.text(function(d,i){return dataCarrier[i];})
		
		var arc = d3.arc()
					.outerRadius(radius)
					.innerRadius(radius - 40);
		var g = svg.selectAll(".arc")
					.data(d3.pie())
					.enter().append("g")
					 .attr("class","arc")
					 
		g.append("path")
			.attr("d",arc)
			.style("fill", function(d, i) { return color[i]; })
			.style("opacity","0.7")
			
		
		
//		g.append("text")
//				.attr("transform", function (d) {
//						return "translate(" + arc.centroid(d)+ ")";
//					})
//				.attr("dy", ".35em")
//				.text(function(d,i){return pielabel[i];});
//	
		
	}

	
	
	

      // add carrier select
      var carrier_list = d3.select('#map')
              .selectAll('span')
              .data(carrierName)
              .enter()
              .append('span')
              .attr('id', function(d) { return d; })
              .text(function(d) { return d; })
              .on('click', select_carrier)
              .style("color", color1)
              .style("font-size", "14px");
	
	// draw map
    var width2 = 650, height1 = 400, width1 = 400, height2 = 500, radius1 = 3, radius2 = 5;
    var margin = {top: 60, right: 20, bottom: 20, left: 80};

    var map = d3.select("#map").append("svg")
            .attr("width", width2)
            .attr("height", height2)
            .attr("id", "left")
            .append("g")
            .attr("transform", "translate(-150, -30)");

    var projection = d3.geoAlbersUsa()
            .scale(800);

    var path = d3.geoPath()
            .projection(projection);

    d3.json("us.json", function(error, us) {
        if (error) throw error;

        map.append("path")
                .attr("class", "states")
                .datum(topojson.feature(us, us.objects.states))
                .attr("d", path);

    });

      // Add month select
      var slider = d3.select("#left")
              .append("g")
              .attr("transform", "translate(30, 470)");


      var x = d3.scaleLinear()
              .range([0, width2])
              .clamp(true);

      slider.append("line")
              .attr("class", "track")
              .attr("x1", x.range()[0])
              .attr("x2", x.range()[1]);

      slider.append("g")
              .attr("transform", "translate(0, 25)")
              .selectAll("text")
              .data(month1)
              .enter()
              .append("text")
              .attr("x", function(d,i) { return i*54; })
              .attr("y", 0)
              .text(function(d) { return d; });

      slider.append("g")
              .selectAll("circle")
              .data(month1)
              .enter()
              .append("circle")
              .attr("id", function(d) { return d; })
              .attr("cx", function(d,i) { return i*54 + 10; })
              .attr("cy", 0)
              .attr("r", 7)
              .style("fill", "#8da0cb")
              .on("click", select_month);



      // Add bar chart
      var bar_data = [];
      var bar = d3.select("#map").append("svg")
              .attr("width", width1)
              .attr("height", height2)
              .append("g")
              .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

      var xScale = d3.scaleLinear()
              .domain([0, d3.max(bar_data, function(d) { return d[1]; })])
              .range([0, width1 - margin.left - margin.right]);

      var yScale = d3.scaleBand()
              .domain(bar_data.map(function(d) {
                  return d[0];
              }))
              .range([0, height2 - margin.top - margin.bottom])
              .padding(0.1);

      bar.append("g")
              .attr("transform", "translate(0, 0)")
              .attr("class", "axis")
              .call(d3.axisTop(xScale));
      bar.append("text")
              .attr("class", "text")
              .attr("x", 150)
              .attr("y", -30)
              .style("text-anchor", "middle")
              .text("Average Delay (min)");

      bar.append("g")
              .attr("class", "axis")
              .call(d3.axisLeft(yScale));
      bar.append("text")
              .attr("class", "text")
              .attr("transform", "rotate(-90)")
              .attr("x", -200)
              .attr("y", -40)
              .style("text-anchor", "middle")
              .text("Destinations");



      function select_carrier(d) {
          d3.selectAll('span')
                  .style("text-decoration", "none")
                  .style("font-weight", "normal");

          d3.select("span[id=" + "'" + d + "'" + "]")
                  .style("text-decoration", "underline")
                  .style("font-weight", "bold");

          slider.select("#" + month_selected)
                  .style("fill", "#fc8d62")
                  .attr("r", 9);

          carrier_selected = d;
          buildResult(carrier_selected, month_selected);

      }

      function select_month(d) {
          slider.selectAll('circle')
                  .style("fill", "#8da0cb")
                  .attr("r", 7);


          slider.select("#" + d)
                  .style("fill", "#fc8d62")
                  .attr("r", 9);

          month_selected = d;
          buildResult(carrier_selected, month_selected);
      }

    var airportIndex = function(code) {
        for (var i = 0; i < airports.length; i++) {
            if (airports[i].code == code) {
                return airports[i].index;
            }
        }
    };

    var indexAirport = function(index) {
        for (var i = 0; i < airports.length; i++) {
            if (airports[i].index == index) {
                return airports[i].code;
            }
        }
    };

      var addLinks = function(d, o) {
          var temp2 = projection([d.longitude,d.latitude]);
          for (var t = 0; t < airports.length; t++) {
              if (airports[t].code == o.dest_code) {
                  var temp = projection([airports[t].longitude, airports[t].latitude]);
                  var angle = Math.atan(Math.abs(temp[1]-temp2[1])/Math.abs(temp[0]-temp2[0]));
                  var angle2 = Math.atan(Math.abs(temp[0]-temp2[0])/Math.abs(temp[1]-temp2[1]));
                  map.append("line")
                          .attr("class", "mapLine")
                          .style("stroke-width", "2px")
                          .attr("x1", function(){
                              if (temp[0]>temp2[0]) {
                                  return temp[0]-5*Math.cos(angle)
                              } else {
                                  return temp[0]+5*Math.cos(angle)
                              }
                          })
                          .attr("y1", function(){
                              if (temp[1]>temp2[1]) {
                                  return temp[1]-5*Math.sin(angle)
                              } else {
                                  return temp[1]+5*Math.sin(angle)
                              }
                          })
                          .attr("x2", function(){
                              if (temp[0]>temp2[0]) {
                                  return temp2[0]+radius1*Math.sin(angle2)
                              } else {
                                  return temp2[0]-radius1*Math.sin(angle2)
                              }
                          })
                          .attr("y2", function(){
                              if (temp[1]>temp2[1]) {
                                  return temp2[1]+radius1*Math.cos(angle2)
                              } else {
                                  return temp2[1]-radius1*Math.cos(angle2)
                              }
                          })
                          .attr("stroke", function(){
                              if(o.average_delay>0) {
                                  return "#fc8d62";
                              } else {
                                  return "#66c2a5";
                              }
                          });
              }
          }
      };



      // After user click submit button, find the right file and compute average delay
      function buildResult(carrierValue, monthValue) {
          var carrier, month;
          switch(carrierValue) {
              case "American Airlines":
                  carrier = "AA";
                  break;
              case "Alaska Airlines":
                  carrier = "AS";
                  break;
              case "JetBlue Airways":
                  carrier = "B6";
                  break;
              case "Delta Airlines":
                  carrier = "DL";
                  break;
              case "Frontier Airlines":
                  carrier = "F9";
                  break;
              case "Hawaiian Airlines":
                  carrier = "HA";
                  break;
              case "United Airlines":
                  carrier = "UA";
                  break;
              case "Virgin America":
                  carrier = "VX";
                  break;
              case "Southwest Airlines":
                  carrier = "WN";
                  break;
          }

          switch(monthValue) {
              case "Jan":
                  month = 1;
                  break;
              case "Feb":
                  month = 2;
                  break;
              case "Mar":
                  month = 3;
                  break;
              case "Apr":
                  month = 4;
                  break;
              case "May":
                  month = 5;
                  break;
              case "Jun":
                  month = 6;
                  break;
              case "Jul":
                  month = 7;
                  break;
              case "Aug":
                  month = 8;
                  break;
              case "Sept":
                  month = 9;
                  break;
              case "Oct":
                  month = 10;
                  break;
              case "Nov":
                  month = 11;
                  break;
              case "Dec":
                  month = 12;
                  break;
          }

          var filePath = "data/filtered_data/" + carrier + "/" + carrier +  "_" + month + ".csv";
          console.log(filePath);
          d3.csv(filePath, function(data) {
              var output = [];
              for (var i = 0; i < 30; i++) {
                  output[i] = [];
                  for (var j = 0; j < 30; j++) {
                      output[i][j] = {
                          total_count: 0,
                          delay_count: 0,
                          carrier_delay: 0,
                          weather_delay: 0,
                          nas_delay: 0,
                          security_delay: 0,
                          late_aircraft_delay: 0
                      }
                  }
              }

              data.forEach(function(d) {
                  d.ARR_DELAY_NEW = +d.ARR_DELAY_NEW;
                  d.CARRIER_DELAY = +d.CARRIER_DELAY;
                  d.WEATHER_DELAY = +d.WEATHER_DELAY;
                  d.NAS_DELAY = +d.NAS_DELAY;
                  d.SECURITY_DELAY = +d.SECURITY_DELAY;
                  d.LATE_AIRCRAFT_DELAY = +d.LATE_AIRCRAFT_DELAY;

                  output[airportIndex(d.ORIGIN)][airportIndex(d.DEST)].total_count++;
                  if(d.ARR_DELAY_NEW > 0) {
                      output[airportIndex(d.ORIGIN)][airportIndex(d.DEST)].delay_count++;
                      output[airportIndex(d.ORIGIN)][airportIndex(d.DEST)].carrier_delay += d.CARRIER_DELAY;
                      output[airportIndex(d.ORIGIN)][airportIndex(d.DEST)].weather_delay += d.WEATHER_DELAY;
                      output[airportIndex(d.ORIGIN)][airportIndex(d.DEST)].nas_delay += d.NAS_DELAY;
                      output[airportIndex(d.ORIGIN)][airportIndex(d.DEST)].security_delay += d.SECURITY_DELAY;
                      output[airportIndex(d.ORIGIN)][airportIndex(d.DEST)].late_aircraft_delay += d.LATE_AIRCRAFT_DELAY;
                  }
              });
              for (var p = 0; p < 30; p++) {
                  result[p] = [];
                  for (var q = 0; q < 30; q++) {
                      if (output[p][q].total_count != 0) {
                          var total_delay = output[p][q].carrier_delay + output[p][q].weather_delay + output[p][q].nas_delay + output[p][q].security_delay + output[p][q].late_aircraft_delay;
                          var average_delay = total_delay/output[p][q].total_count;
                          result[p].push ({
                              dest_code: indexAirport(q),
                              dest_index: q,
                              average_delay: average_delay,
                              total_count: output[p][q].total_count,
                              delay_count: output[p][q].delay_count,
                              total_delay: total_delay,
                              carrier_delay: output[p][q].carrier_delay,
                              weather_delay: output[p][q].weather_delay,
                              nas_delay: output[p][q].nas_delay,
                              security_delay: output[p][q].security_delay,
                              late_aircraft_delay: output[p][q].late_aircraft_delay
                          })
                      }
                  }
              }
          });


          var createDot = function(d) {
              dot.transition()
                      .style("opacity", function(o) {
                          if (isConnectedAsTarget(o, d)) return 1;
                          else return 0.5;
                      })
                      .style("fill", function(o) {
                          if (isConnectedAsTarget(o, d)) return "#8da0cb";
                          else return "gray";
                      })
                      .attr("r", function(o) {
                          if (isConnectedAsTarget(o, d)) return radius2;
                          else return radius1;
                      });

              d3.select("#" + d.code)
                      .transition()
                      .style("fill", "black")
                      .style("opacity", 1)
                      .attr("r", radius2);

              result[d.index].forEach(function(o) {
                  addLinks(d, o);
                  bar_data.push ([o.dest_code, o.average_delay, o.carrier_delay, o.weather_delay, o.nas_delay, o.security_delay, o.late_aircraft_delay]);
              });

          };

          var createBar = function() {
              xScale = d3.scaleLinear()
                      .domain([0, d3.max(bar_data, function(d) { return d[1]; })])
                      .range([0, width1 - margin.left - margin.right]);

              yScale = d3.scaleBand()
                      .domain(bar_data.map(function(d) {
                          return d[0];
                      }))
                      .range([0, height2 - margin.top - margin.bottom])
                      .padding(0.1);

              bar.append("g")
                      .attr("transform", "translate(0, 0)")
                      .attr("class", "axis")
                      .call(d3.axisTop(xScale));

              bar.append("g")
                      .attr("class", "axis")
                      .call(d3.axisLeft(yScale));

              bar.selectAll(".bar")
                      .data(bar_data)
                      .enter().append("rect")
                      .attr("class", "bar")
                      .style("fill", "#fc8d62")
                      .style("opacity", 0.8)
                      .attr("x", 0)
                      .attr("y", function(d) { return yScale(d[0]); })
                      .attr("height", yScale.bandwidth())
                      .attr("width", function(d) { return xScale(d[1]); })
                      .append("title")
                      .text(function(d) { return d[1]; });
          };

          var updateBar = function() {
              bar.selectAll(".bar")
                      .remove();

              bar.selectAll(".axis")
                      .remove();

              bar_data = [];
          };

          var mapMouseOver = function(d) {
              origin_selected = d;

              map.selectAll(".mapLine")
                      .remove();

              updateBar();

              createDot(d);

              createBar();
          };


          if (origin_selected == null) {
              var dot = map.selectAll(".circle")
                      .data(airports)
                      .enter().append("circle")
                      .attr("class", "dot")
                      .attr("id", function(d){
                          return d.code;
                      })
                      .style("fill", "gray")
                      .style("opacity", 0.5)
                      .attr("r", radius1)
                      .attr("transform", function(d) { return "translate(" + projection([d.longitude, d.latitude]) + ")";})
                      .on("mouseover", mapMouseOver);

              dot.append("title")
                      .text(function(d) { return d.code; });
          } else {
              dot = map.selectAll(".dot")
                      .style("opacity", 0.5)
                      .attr("r", radius1)
                      .style("fill", "gray");

              map.selectAll(".mapLine")
                      .remove();

              updateBar();

              createDot(origin_selected);

              createBar();
          }


          function isConnectedAsTarget(a, b) {
              for(var i = 0; i < result[a.index].length; i++) {
                  if(result[a.index][i].dest_index == b.index) {
                      return true;
                  }
              }
              return false;
          }

      }

/*************************************************************************************************************************************************
THIS IS THE CODE FOR THE PCP
*************************************************************************************************************************************************/

      d3.csv("data/carrier_general.csv", function(err, carrier_data) {
        var data = [];
        for (i = 0; i < carrier_data.length; i++){
          data.push({
                    "2010": carrier_data[i]["2010_ontime"],
                    "2011": carrier_data[i]["2011_ontime"],
                    "2012": carrier_data[i]["2012_ontime"],
                    "2013": carrier_data[i]["2013_ontime"],
                    "2014": carrier_data[i]["2014_ontime"],
                    "2015": carrier_data[i]["2015_ontime"],
                    "carrier": carrier_data[i]["Carrier"]
                  });
        }
        var m = [0, 10, 10, 150],
          w = 1000 - m[1] - m[3],
          h = 400 - m[0] - m[2];
        var x = d3.scaleBand().range([0, w]);
        var y = {};
        var div = d3.select("#graph").append("div") 
                    .attr("class", "tooltip")       
                    .style("opacity", 0);
        var dragging = {};
        var line = d3.line();
        var axis = d3.axisLeft();
        var background;
        var foreground;
        var svg = d3.select("#graph").append("svg:svg")
          .attr("width", w + m[1] + m[3])
          .attr("height", h + m[0] + m[2])
          .append("svg:g")
          .attr("transform", "translate(" + m[3] + "," + m[0] + ")");
        x.domain(dimensions = d3.keys(carrier_data[0]).filter(function(d) {
          return d != "Name" && (
            y[d] = d3.scaleLinear()
                     .domain([70, 100]).range([h, 0]));
        }));
        var path = function(d) {
          return line(dimensions.map(function(p) {
          	if (d[p] == ""){
          	return [280,215];}
            if (p != "Name" ){
            return [position(p), y[p](d[p])];}
          }));
        }
        foreground = svg.append("svg:g")
          .attr("class", "foreground")
          .selectAll("path")
          .data(carrier_data)
          .enter().append("svg:path")
          .attr("class", "lines")
          .attr("d", path)
          .on("mouseover", function(d) {   
          	var foo1 = d3.selectAll(".lines");
            foo1.style("stroke", 'grey');
            foo1.style("opacity", '0.2');
            var foo = d3.select(this);
            foo.style("stroke-width", '5px');
            foo.style("stroke", 'red');
            foo.style("opacity", '0.9');
            ticksData = d;
            d3.selectAll('g.tick').style("opacity", '0.1')
            d3.selectAll('g.tick')
  			.filter(function(d){return d==ticksData["2010_ontime"] || d==ticksData["2011_ontime"] || d==ticksData["2012_ontime"] 
  				|| d==ticksData["2013_ontime"] || d==ticksData["2014_ontime"] || d==ticksData["2015_ontime"] ;} ).style("opacity", '1')
            })          
          .on("mouseout", function(d) {   
              var foo = d3.select(this);
              var foo1 = d3.selectAll(".lines");
              foo.style("stroke-width", '1.5px');
              foo.style("stroke", 'steelblue');
              foo1.style("stroke", 'steelblue');
              foo1.style("opacity", '0.9');
              d3.selectAll('g.tick').style("opacity", '1')
          });
        var g = svg.selectAll(".dimension")
          .data(dimensions)
          .enter().append("svg:g")
          .attr("class", "dimension")
          .attr("transform", function(d) {
            return "translate(" + x(d) + ")";
          });
        g.append("svg:g")
          .attr("class", "axis")
          .each(function(d) {
            ticks = [];
            names = [];
            for (i = 0; i < carrier_data.length; i++){
              ticks.push(carrier_data[i][d]);
              names.push(carrier_data[i]["Name"])
            }

            if (d == "2010_ontime"){
              d3.select(this).call(d3.axisLeft(y[d]).tickValues(ticks).tickFormat(function(d,i){return names[i] +" " + ticks[i]; }));
            }
            else {
            d3.select(this).call(d3.axisRight(y[d]).tickValues(ticks));}
          });
        g.append("text")
          .attr("text-anchor", "middle")
          .attr("x", -20)
    	  .attr("y", 10)
          .attr("stroke", "3px")
          .text(function (d){return d.split("_")[0];});
        function position(d) {
          var v = dragging[d];
          return v == null ? x(d) : v;
        }
        function transition(g) {
          return g.transition().duration(500);
        }
        function path(d) {
          return line(dimensions.map(function(p) {
            if (p != "Name"){
            return [position(p), y[p](d[p])];}
          }));
        }
    });

/*************************************************************************************************************************************************
THIS IS THE CODE FOR THE TREEMAP
*************************************************************************************************************************************************/

	for (i = 1; i <= 12; i++){
			drawTreemap(i);
	}
	function drawTreemap (number){
      var width = 250,
      height = 140;
      var format = d3.format(",d");
      var color = d3.scaleOrdinal()
          .range(d3.schemeCategory10
              .map(function(c) { c = d3.rgb(c); c.opacity = 0.6; return c; }));
      var stratify = d3.stratify()
          .parentId(function(d) { return d.id.substring(0, d.id.lastIndexOf(".")); });
      var treemap = d3.treemap()
          .size([width, height])
          .padding(1)
          .round(true);
      d3.csv("data/filtered_data/cancellationData_" + number + ".csv", type, function(error, data) {
        if (error) throw error;
        indivVals= {};
        for (i = 0; i < data.length; i++){
        	indivVals[data[i].id] = data[i].value;
        }
        indivValsYears= {};
        for (i = 0; i < data.length; i++){
        	indivValsYears[data[i].id + "_" + number] = data[i].value;
        }
        console.log(indivValsYears)
        carrierCodes = ["AA", "AS", "B6", "DL" , "WN", "F9", "HA", "UA", "VX"];
        carrierTotals =  [];
        for (i = 0; i < carrierCodes.length; i++){
        	carrierTotals.push({"name": "Carrier." + carrierCodes[i], "value": 0})
        }
        for (i = 0; i < carrierTotals.length; i++){
        	totalval = 0;
        	for (j = 0; j < data.length; j++){
        		if (data[j].id == carrierTotals[i].name + ".cancelA"){
        			totalval = totalval + data[j].value;
        		} else if (data[j].id == carrierTotals[i].name  + ".cancelB"){
        			totalval = totalval + data[j].value;
        		} else if (data[j].id == carrierTotals[i].name  + ".cancelC"){
        			totalval = totalval + data[j].value;
        		}else if (data[j].id == carrierTotals[i].name  + ".cancelD") {
        			totalval = totalval + data[j].value;
        		}
        	}
        	carrierTotals[i].value = totalval;
        }
        for (i = 0; i < carrierTotals.length; i++) {
        	for (j = 0; j < data.length; j++){
        		if (data[j].id == carrierTotals[i].name + ".cancelA"){
        			data[j].value = data[j].value / carrierTotals[i].value;
        		} else if (data[j].id == carrierTotals[i].name + ".cancelB"){
        			data[j].value = data[j].value / carrierTotals[i].value;
        		} else if (data[j].id == carrierTotals[i].name + ".cancelC"){
        			data[j].value = data[j].value / carrierTotals[i].value;
        		}else if (data[j].id == carrierTotals[i].name + ".cancelD") {
        			data[j].value = data[j].value / carrierTotals[i].value;
        		}
        	}
        }
        var root = stratify(data)
            .sum(function(d) { if (d.id.split(".")[1] == "AA" || d.id.split(".")[1] == "AS" || d.id.split(".")[1] == "B6" || d.id.split(".")[1] == "DL" || d.id.split(".")[1] == "F9" || d.id.split(".")[1] == "HA" || d.id.split(".")[1] == "UA" || d.id.split(".")[1] == "VX" || d.id.split(".")[1] == "WN"  ) {return d.value;} })
            .sort(function(a, b) { return b.height - a.height || b.value - a.value; });
        treemap(root);
        d3.select("#treemap" + number)
          .selectAll(".node")
          .data(root.leaves())
          .enter().append("div")
			.attr("class", function(d){return "node " +  d.id.split(".")[0]+d.id.split(".")[1]+d.id.split(".")[2] + " " + number + " " + indivVals[d.id]})
            .attr("title", function(d) {
             var carrierInfor =  getCarrierName(d);
             return carrierInfor; })
            .style("left", function(d) { return d.x0 +"px"; })
            .style("top", function(d) { return d.y0 + "px"; })
            .style("width", function(d) { return d.x1 - d.x0 + "px"; })
            .style("height", function(d) { return d.y1 - d.y0 + "px"; })
            .style("background", function(d) { while (d.depth > 1) d = d.parent; return getColor(d.id.split(".")[1]); })
            .on("mouseover", function(d) {   
            	var months = {"1": "January", "2": "February", "3": "March", "4": "April", "5": "May", "6": "June", "7": "July", "8": "August", "9": "September", "10": "October", "11": "November", "12": "December"};
	          	var foo1 = d3.selectAll(".node");
	            foo1.style("opacity", '0.3');
	            var foo = d3.select(this);
	            var alldivs = d3.selectAll("." + foo._groups[0][0].className.split(" ")[1]);
	            alldivs.style("opacity", '2');
	            code = d.id.split(".")[2];
	            carrier = d.id.split(".")[1];
                if (code == "cancelA"){
                  code = "Carrier";
                } else  if(code == "cancelB"){
                  code = "Weather";
                } else  if(code == "cancelC"){
                  code = "National Air System";
                } else  if(code == "cancelD"){
                  code = "Security";
                }
                console.log(d)
                $("#causeSpan").text(code);
                $("#carrierSpan").text(getCarrierName(d));
                $("#monthSpan").text(months[foo._groups[0][0].className.split(" ")[2]]);
                console.log(foo._groups[0][0].className.split(" ")[2])
                $("#cancelSpan").text(foo._groups[0][0].className.split(" ")[3])
                $("#cancelInfo").show();
            }) 
            .on("mouseout", function(d) {   
	          	var foo1 = d3.selectAll(".node");
	            foo1.style("opacity", '1');	    
	            // $("#cancelInfo").hide();        
            })  
          .append("div")
            .attr("class", "node-label")
            .text(function(d) { return d.id.split(".")[1];})
          .append("div")
            .attr("class", function(d){ return d.id + " node-value"})
            .text(function(d) {return format(indivVals[d.id]); });

      });
	}
      function type(d) {
        d.value = +d.value;
        return d;
      } 
      function getColor(id){
      	var col;
      	switch(id) {
            case "AA":
                col = "#1f77b4";
                break;
            case "AS":
                col = "#ff7f0e";
                break;
            case "B6":
                col = "#2ca02c";
                break;
            case "DL":
                col = "#acb02f";
                break;
            case "F9":
                col = "#d62728";
                break;
            case "HA":
                col = "#9467bd";
                break;
            case "UA":
                col = "#8c564b";
                break;
            case "VX":
                col = "#e377c2";
                break;
            case "WN":
                col = "#7f7f7f";
                break;
      	}
      	return col;
  	  }
  	  function getCarrierName (d) {
  	  	var carrierInfor =  "";
		var carrierValue = d.id.split(".")[1];
		switch(carrierValue) {
            case "AA":
                carrierInfor = "American Airlines";
                break;
            case "AS":
                carrierInfor = "Alaska Airlines";
                break;
            case "B6":
                carrierInfor = "JetBlue Airways";
                break;
            case "DL":
                carrierInfor = "Delta Airlines";
                break;
            case "F9":
                carrierInfor = "Frontier Airlines";
                break;
            case "HA":
                carrierInfor = "Hawaiian Airlines";
                break;
            case "UA":
                carrierInfor = "United Airlines";
                break;
            case "VX":
                carrierInfor = "Virgin America";
                break;
            case "WN":
                carrierInfor = "Southwest Airlines";
                break;
        } 
        return carrierInfor;
  	  }
	</script>
</body>

</html>